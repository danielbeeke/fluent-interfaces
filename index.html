<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fluent APIs and libraries</title>
  <script type="module" src="presentation.js"></script>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
</head>
<body>
  <div class="reveal">
    <div class="slides">
      <section data-markdown>
        <textarea data-template>
          # Fluent APIs and libraries
          __All you need to know to make your own!__
          ---
          ## About me
          [DaniÃ«l Beeke](https://danielbeeke.nl),<br />
          Software engineer at [OM MediaWorks](https://www.om.org/mediaworks)

          Dutch, living in Stockerau
          ---
          # My background

          Fullstack<br>
          I did a lot of Drupal before doing JS full time.

          Working on a headless CMS that:
          - uses RDF as data
          - outputs PWA's with ease
          - plans for federating of data between multiple instances
          - here I learned about fluent APIs

          ---

          ## Chapters

          - What are Fluent API's?
          - Use cases
          - Different types of chains
          - Core concepts
          ---
          ## What are Fluent API's?

          You probably have been working with them.

          Note:
          - You might not know the concept but...
          - Who has been working with Fluent API's?
        </textarea>
      </section>
      <section>
        <h1>What are Fluent API's?</h1>
<pre class="fragment"><code class="JavaScript hljs">
jQuery('.my-button').fadeOut().remove()
</code></pre>
<pre class="fragment"><code class="JavaScript hljs">
new Person()
  .firstName('John')
  .lastName('Doo')
  .dateOfBirth('05-09-1883')
  .save()
</code></pre>
      </section>
      <section>
        <h3>Fluent Snake</h3>
<pre class=""><code class="JavaScript hljs">
await api
  .fetch('https://en.wikipedia.org/wiki/Linux')
  .querySelector('.infobox tr:nth-child(4) a')
  .href()
  .fetch()
  .querySelector('#firstHeading')
  .text()

// Unix-like
  </code></pre>
      </section>
      <section>
        <h3>LDflex</h3>
<pre class=""><code class="JavaScript hljs">
await solid.data['https://danielbeeke.nl/']['foaf:img']

// https://danielbeeke.nl/images/daniel.jpg
  </code></pre>
      </section>

      <section><iframe class="has-mouse" data-src="https://ldflex.github.io/Solid-Playground/#%5B'https%3A%2F%2Fdanielbeeke.nl%2F'%5D%5B'foaf%3Atopic_interest'%5D" data-preload></iframe></section>
        <section data-markdown>
          <textarea data-template>
            # What are Fluent API's?

            ### Developer experience

            - Abstractions on top of complexity
            - Provide easy access to data
            - Feel like objects
            - TypeScript autocompletion

            ---

            # Use cases

            - API libraries
            - Data bindings for the template
            - Query builders
          </textarea>
      </section>

      <section>
        <h1>API libraries</h1>
        <em>moment.js:</em>
<pre class=""><code class="JavaScript hljs">
moment('20111031', 'YYYYMMDD')
  .subtract(6, 'days')
  .fromNow()
</code></pre>
      </section>

      <section>
        <h1>Data bindings for the template</h1>
        <em><a href="https://github.com/danielbeeke/omni/blob/main/src/index.js">Omni prototype</a> (uses <a href="https://github.com/LDflex/LDflex">LDflex</a> and <a href="https://github.com/WebReflection/uhtml">uhtml/async</a>)</em>
<pre class=""><code class="JavaScript hljs">
const source = 'https://ruben.verborgh.org/profile/'
const omni = await new Omni(source, { context })
const person = omni.get(source + '/#me')

render(document.body, html`
  <h1>${person.name}</h1>
  <ul>${person.friends.givenName.map(name => html`
    <li>${name}</li>`)}
  </ul>
`);
</code></pre>
      </section>

      <section>
        <h1>Query builders</h1>
        <em>knex.js:</em>
<pre class=""><code class="JavaScript hljs">
knex.select('id').from('users')
</code></pre>
      </section>


      <section>
        <h1>Query builders</h1>
        <em>Our PWAs querying the headless CMS:</em>
<pre class=""><code class="JavaScript hljs">
const offset = state.page * this.pageSize
const limit = this.pageSize

const overviewQuery = query(queryTypes)
  .sort({ name: 'asc' })
  .filter(filters)
  .addSidetrack('authors')
  .addSidetrack('category')
  .paginate({ offset, limit })
</code></pre>
      </section>
      <section><h1>Different types of chains</h1>
        <p>Let's try to categorize the chains that we have seen.</p>
      </section>

      <section><iframe data-src="illustration-slides.svg#builder-chain" data-preload></iframe></section>
      <section><iframe data-src="illustration-slides.svg#queue-chain" data-preload></iframe></section>
      <section><iframe data-src="illustration-slides.svg#proxy-chain" data-preload></iframe></section>

      <section><h1>Core concepts</h1></section>
      <section>
        <h1>Methods must return 'this'</h1>
<pre class=""><code class="JavaScript hljs">
class Thing {
  methodA () { return this }

  methodB () {
    console.log('b')
    return this
  }
}

const item = new Thing().methodA().methodB()
// b
</code></pre>
      </section>
      

      <section>
        <h1>getters</h1>
<pre class=""><code class="JavaScript hljs">
class Thing {

  get fruit () {
    return 'pear'
  }

}

console.log(item.fruit)
// pear
</code></pre>
      </section>

      <section><iframe data-src="illustration-slides.svg#getters" data-preload></iframe></section>

      <section>
        <h1>You can use .then() to have async chains</h1>
<pre class=""><code class="JavaScript hljs">
class Thing {

  async then (resolve) {
    // Do async things here ...
    resolve('Hello World')
  }

}

const item = new Thing()
console.log(await item)
// Hello World
</code></pre>
      </section>

      <section>
        <h1>Promise chain</h1>

        <p>These can be used to return the value. Every segment of the chain appends a new Promise to the previous Promise.</p>

<pre><code class="JavaScript hljs">
// A Promise chain

const person = await fetch('/user.json')
  .then(response => response.json())
  .then(response => new Person(response))
</code></pre>
        
      </section>

      <section>
        <h1>Proxy</h1>
        <p>A layer on top of an object which can intercept and<br>
          redefine fundamental operations on that object.</p>
 
          <p>We might want to have segments with properties we do not know beforehand.</p>
   
      </section>

      <section>
        <h1>Proxy example</h1>

        <pre><code class="JavaScript hljs">
const myObject = { hello: 'world' }

const proxy = new Proxy(myObject, {
  get: function(target, prop, receiver) {
    return 'Vienna'
  }
})

proxy.hello // Vienna
proxy.gutenTag // Vienna
        </code></pre>
      
      </section>


      <section><iframe data-src="illustration-slides.svg#await-vs-then" data-preload></iframe></section>
      <section data-markdown>
        <textarea data-template>
          # Summary

          - Fluent APIs enable DX
          - There are multiple types of chains (async / sync)
          - Core concepts
            - return this
            - getter methods
            - Proxies for unknown properties
            - then() for async chains

          ---

          # Questions, thoughts? Thanks!

          Interested? Here are some links

          - [Fluent Calculator, a step by step tutorial](https://github.com/danielbeeke/fluent-calculator/)
          - [Fluent Snake, fluent API helper library](https://github.com/danielbeeke/fluent-snake/)
          - [LDflex, linked data fluent API](https://github.com/LDflex/LDflex)
          - [Builder pattern](https://refactoring.guru/design-patterns/builder)
          - [MDN Proxy](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy)

        </textarea>
    </section>
    </div>
  </div>
</body>
</html>